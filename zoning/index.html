<!DOCTYPE html>
<html>

<head>
    <meta charset=utf-8 />
    <title>Bourbon County Zoning Atlas</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css"
  integrity="sha512-M2wvCLH6DSRazYeZRIm1JnYyh22purTM+FDB5CsyxtQJYeKq83arPe5wgbNmcFXGqiSH2XR8dT/fJISVA1r/zQ=="
  crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js"
  integrity="sha512-lInM/apFSqyy1o6s89K4iQUKg6ppXEgsVxT35HbzUupEVRh2Eu9Wdl4tHj7dZO0s1uvplcYGmt3498TtHq+log=="
  crossorigin=""></script>

    <style>
        body {
            margin: 0;
            padding: 0;
        }
        #map {
            position: absolute;
            width: 100%;
            top: 0;
            bottom: 0;
        }
        #hover-window {
            background: whitesmoke;
            box-shadow: 0 1px 5px rgba(0,0,0,.65);
            padding: 6px 8px;
            border-radius: 4px;
            min-height: 40px;
            min-width: 60px;
            text-align: left;
            position: absolute;
            display: none;
            z-index: 500;
        }
/*
        h1 {
            font-family: 'Rock Salt', cursive;
            font-size: 1.5em;
            padding: 0;
        }
        p {
            font-family: 'Lato', sans-serif;
            font-size: 1em;
        }
        p2 {
            font-family: 'Nothing You Could Do', cursive;
            font-size: 1.5em;
            line-height: 75%;
            margin: 0px;
        }
     
        
    </style>
    
</head>

<body>
    
    <div id='map'></div>
    <div id='hover-window'></div>
    
    <script src ="Flood_100yr.js"></script>
    <script src ="Flood_Zoning_Union.js"></script>
    <script src ="Zoning_2014.js"></script>
    
    <script>

        var map;
        var targetDiv = 'map';
        
        var options = {
            center: [38.205,-84.254040],
            zoom: 13,
            maxZoom: 18,
            minZoom: 12,
            attributionControl: false,
        }        
        
        
        map = L.map(targetDiv, options);
        
        
    //set bounds manually
//      set bounds based on zoom level 5 (for buffer room)
//        var southWest = L.latLng(26.076, -111.665),
//            northEast = L.latLng(48.835, -51.635),
//            bounds = L.latLngBounds(southWest, northEast);
//        
//        map.setMaxBounds(bounds);
        
        //set bounds automatically
        var getBounds = map.getBounds();
          
        var bounds = L.latLngBounds(getBounds);    
        
        map.setMaxBounds(bounds);
        

        var tiles = L.tileLayer('https://{s}.google.com/vt/lyrs=s,h&x={x}&y={y}&z={z}',{
            maxZoom: 20,
            subdomains:['mt0','mt1','mt2','mt3']
        });
        

        map.addLayer(tiles);
        
//           L.Control.Zoom({ position: 'bottomright' }).addTo(map);

        
        //add zoneLayer
        var zoneLayer = L.geoJson(zones, {
            
           style: function(feature) {
               return {
                   weight: 0,
                   fillOpacity: 0.75,
                   fillColor: getColor(feature.properties["ZONE_"]),
               }
           }, 
            onEachFeature: function(feature, layer){
                layer.on('mouseover', function(e){
                    layer.setStyle({
                        color: 'yellow'
                    })
                    layer.bringToFront();
                });
                layer.on('mouseout', function(e){
                    layer.setStyle({
                        color: 'black'
                    })
                })

            }
                     
        }).addTo(map);
        
        var floodLayer = L.geoJson(flood, {
             
            onEachFeature: function(feature, layer){
                layer.on('mouseover', function(e){
                    layer.setStyle({
                        color: 'yellow'
                    })
                    layer.bringToFront();
                });
                layer.on('mouseout', function(e){
                    layer.setStyle({
                        color: 'black'
                    })
                })

            }
                     
        }).addTo(map);
        
           //add unionLayer 
        var unionLayer = L.geoJson(union, {
            
           style: function(feature) {
               return {
                   weight: 0,
                   fillOpacity: 0
               }
            },             
        }).addTo(map);
        
        //send union layer to make popup
        createPopup(unionLayer);
        
        map.on("overlayadd", function (event) {
            unionLayer.bringToFront();
        });
            
        map.on("baselayerchange", function(event){
            unionLayer.bringToFront();
        });
         
//        function createPopup(data){
//            data.eachLayer(function(layer){
//                
//                var props = layer.feature.properties;
//
//                var infoWindow = $('#hover-window');
//             
//                //for hovers
//                layer.on('click', function(e){
//                    
////                    if(e.target.feature.geometry =="MultiPolygon"){
////                        
////                    }
//                        
//                    
//                    console.log(e.target.feature.geometry);
//                    
//                    var props = this.feature.properties;                  
//               
//        
//                    infoWindow.show();
//                    infoWindow.html("Zone: "+props["ZONE_"]+"<br>"+"Land-use Code: "+props["LU_C"]);
//                    
//                    $(layer).click(function(e){
//                        
//                        console.log(e.target);
//                        //first offset from the mouse position of the info window
//                        infoWindow.css({"left": e.pageX + 6, "top": e.pageY - infoWindow.height() - 15}); 
//                        
//                        //if crashes into top, flip to lower right
//                         if(infoWindow.offset().top < 4) {
//                            infoWindow.css({"top": e.pageY + 15});
//                        }
//                        
//                        //if crashes right, flip again
//                        if(infoWindow.offset().left + infoWindow.width() >= $(document).width() - 40) {
//                            infoWindow.css({"left": e.pageX - infoWindow.width() - 30});
//                        }
//                    })
//
//                });
//                
////                map.on('click', function(e){
////                    infoWindow.fadeOut();
////                });
//                
////                layer.on('mouseout', function(e){
////                    infoWindow.hide();
////                })
////                
//            })
//        }
//        
        
    
        function getColor (zone) {
        
            
                if(zone == "A-1") {
                    return '#8dd3c7';
                } else if(zone == "A-2") {
                    return '#1f78b4';
                } else if(zone == "B-1") {
                    return '#b2df8a';
                } else if(zone == "B-2") {
                    return '#33a02c'
                } else if (zone == "C"){
                    return '#e31a1c'
                } else if(zone == "I-1") {
                    return '#fdbf6f'
                } else if(zone == "I-2") {
                    return '#ff7f00'
                } else if(zone == "R-1") {
                    return '#cab2d6'
                } else if (zone == "R-2"){
                    return '#6a3d9a'
                } else if (zone == "R-3"){
                    return '#fee08b'
                } else if (zone == "R-4"){
                    return '#ccebc5'
                }
        }
      
     var controls = {
        "100yr. Flood": floodLayer,
    };
        
    var controls_zone = {
        "Zones": zoneLayer,
    };
                
//    L.control.layers(controls, { collapsed:false, postion: 'topright'}).addTo(map);
        
    L.control.layers(controls, controls_zone).addTo(map);
   
    
        
          
    </script>
    
</body>

</html>