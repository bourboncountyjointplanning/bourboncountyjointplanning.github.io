<!DOCTYPE html>
<html>

<head>
    <meta charset=utf-8 />
    <title>Bourbon County Zoning Atlas</title>
<!--    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="https://cartodb-libs.global.ssl.fastly.net/cartodb.js/v3/3.15/cartodb.js"></script>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css"
  integrity="sha512-M2wvCLH6DSRazYeZRIm1JnYyh22purTM+FDB5CsyxtQJYeKq83arPe5wgbNmcFXGqiSH2XR8dT/fJISVA1r/zQ=="
  crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js"
  integrity="sha512-lInM/apFSqyy1o6s89K4iQUKg6ppXEgsVxT35HbzUupEVRh2Eu9Wdl4tHj7dZO0s1uvplcYGmt3498TtHq+log=="
  crossorigin=""></script>

    <style>
        
        body {
            padding: 0;
            margin: 0;
        }
        html, body, #map {
            height: 100%;
            width: 100vw;
        }
/*
        body {
            margin: 0;
            padding: 0;
        }
        #map {
            position: absolute;
            width: 100%;
            top: 0;
            bottom: 0;
        }
*/
/*
        h1 {
            font-family: 'Rock Salt', cursive;
            font-size: 1.5em;
            padding: 0;
        }
        p {
            font-family: 'Lato', sans-serif;
            font-size: 1em;
        }
        p2 {
            font-family: 'Nothing You Could Do', cursive;
            font-size: 1.5em;
            line-height: 75%;
            margin: 0px;
        }
     
        
    </style>
    
</head>

<body>
    
    <div id='map'></div>
    <div id='hover-window'></div>
    
    <script src ="Flood_100yr.js"></script>
    <script src ="Flood_Zoning_Union.js"></script>
    <script src ="Zoning_2014.js"></script>
    <script src ="landuse.js"></script>
    
    <script>

        var map;
        var targetDiv = 'map';
        
        var options = {
            center: [38.205,-84.254040],
            zoom: 13,
            maxZoom: 18,
            minZoom: 12,
            attributionControl: false,
        }        
        
        
        map = L.map(targetDiv, options);
        
        
    //set bounds manually
//      set bounds based on zoom level 5 (for buffer room)
//        var southWest = L.latLng(26.076, -111.665),
//            northEast = L.latLng(48.835, -51.635),
//            bounds = L.latLngBounds(southWest, northEast);
//        
//        map.setMaxBounds(bounds);
        
        //set bounds automatically
        var getBounds = map.getBounds();
          
        var bounds = L.latLngBounds(getBounds);    
        
        map.setMaxBounds(bounds);
        

        var tiles = L.tileLayer('https://{s}.google.com/vt/lyrs=s,h&x={x}&y={y}&z={z}',{
            maxZoom: 20,
            subdomains:['mt0','mt1','mt2','mt3']
        });
        

        map.addLayer(tiles);
        
        addData();

        
       function addData(){
        
           
           //add flood layer
            var floodLayer = L.geoJson(flood, {

                style: function(feature){
                    return {
                        opacity: 0.85,
                        color: '#1f78b4'
                    }
                },           

            }).addTo(map);
           
           //addlanduse layer
            var landuseLayer = L.geoJson(landuse, {
                style: function(feature){
                    return {
                        color: 'black'
                    }
                }
            }).addTo(map);
           
           //add zoneLayer
            var zoneLayer = L.geoJson(zones, {

               style: function(feature) {
                   return {
                       weight: 0,
                       fillOpacity: 0.9,
                       fillColor: getColor(feature.properties["ZONE_"]),
                       color: '#636363'
                   }
               }, 

            }).addTo(map);

            //add unionLayer 
            var unionLayer = L.geoJson(union, {

               style: function(feature) {
                   return {
                       weight: 0,
                       fillOpacity: 0
                   }
                },             
            }).addTo(map);
           
           //send union layer to make popup
           createPopup(unionLayer);
           
           makeLayerControl(zoneLayer, floodLayer, landuseLayer, unionLayer);
       }
        
        
        
        function createPopup(data){
            data.eachLayer(function(layer){
                
                var props = layer.feature.properties;
                
                layer.bindPopup("Zone: "+props["ZONE_"]+"<br>"+"Land-use Code: "+props["LU_C"])
            })
        }
        

    
    function getColor(zone){
        
            
                if(zone == "A") {
                    return '#9E4624';
                } else if(zone == "B-1") {
                    return '#DD4132';
                } else if(zone == "B-2") {
                    return '#9B2335';
                } else if(zone == "B-3") {
                    return '#BC243C'
                } else if (zone == "C"){
                    return '#F6D155'
                } else if(zone == "H") {
                    return '#B76bA3'
                } else if(zone == "H-M") {
                    return '#F7C4C9'
                } else if(zone == "I-1") {
                    return '#88B04B'
                } else if (zone == "I-2"){
                    return '#006E51'
                } else if (zone == "NOZONE"){
                    return '#9896A4'
                } else if (zone == "PUD"){
                    return '#B18F6A'
                } else if (zone == "R-1"){
                    return '#98B4D4'
                } else if (zone == "R-2"){
                    return '#5B5EA6'
                } else if (zone == "R-3"){
                    return '#92A8D1'
                } else if (zone == "R-4"){
                    return '#034F84'
                } else if (zone == "R-5"){
                    return '#91A8D0'
                } else if (zone == "R-6"){
                    return '#4C6A92'
                } else if (zone == "R-7"){
                    return '#004B8D'
                } else if (zone == "R-8"){
                    return '#578CA9'
                } 
        
    }
    

    function makeLayerControl(zone, flood, landuse, union){
        
        var layersGroup = {
            "Zones": zone,
            "100yr. Flood": flood,
            "Landuse": landuse,
        };
        
        console.log(layersGroup);
        
        L.control.layers(null, layersGroup, {collapsed: false, position: 'topright'}).addTo(map);
        
         $(".leaflet-control-layers").prepend('<label><input id="show-all" type="checkbox" class="leaflet-control-layers-selector" checked=""><span>SHOW all layers</span></label><label><input id="hide-all" type="checkbox" class="leaflet-control-layers-selector"><span>HIDE all layers</span></label><hr>');

        $("#show-all").change(function(e){
            if(!this.checked){
             // is now unchecked
                for(var layer in layersGroup) {
                    map.removeLayer(layersGroup[layer]);   
                }
                $(".leaflet-control-layers input").prop('checked', false);
                $("#hide-all").prop('checked', true);

            } else {
              // is now checked
                for(var layer in layersGroup) {
                    map.addLayer(layersGroup[layer]);   
                }
                $(".leaflet-control-layers input").prop('checked', true);
                $("#hide-all").prop('checked', false);

            }
        });

        $("#hide-all").change(function(e){
            if(!this.checked){
             // is now unchecked
                for(var layer in layersGroup) {
                    map.addLayer(layersGroup[layer]);   
                }
                $(".leaflet-control-layers input").prop('checked', true);
                $("#show-all").prop('checked', true);
                $("#hide-all").prop('checked', false);

            } else {
              // is now checked
                for(var layer in layersGroup) {
                    map.removeLayer(layersGroup[layer]);   
                }
                $(".leaflet-control-layers input").prop('checked', false);
                $("#hide-all").prop('checked',true);

            }
        });
        
           map.on("overlayadd", function (event) {
            union.bringToFront();
        });
            
        map.on("baselayerchange", function(event){
            union.bringToFront();
        });
        
    }
        
    
    
        
          
    </script>
    
</body>

</html>